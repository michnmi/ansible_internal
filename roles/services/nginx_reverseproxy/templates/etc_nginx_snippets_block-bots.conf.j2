# Generated by Ansible — lightweight bot/scanner mitigations.
# Include this inside each server {}.

# Allow ACME challenges unconditionally (don’t break certbot HTTP-01)
location ^~ /.well-known/acme-challenge/ {
    # Use your existing ACME webroot if you have one; otherwise leave as-is
    default_type "text/plain";
    try_files $uri =404;
}

# Block hidden files (e.g., .git, .env, .htaccess) BUT allow /.well-known/*
location ~ /\.(?!well-known) {
    return 444;
}

# Block obvious backup/swap/archive extensions
location ~* \.(bak|old|save|swp|swo|orig|tmp|zip|tar|tgz|gz|7z)$ {
    return 444;
}

# Block common scanner targets you don’t use
location ~* /(phpmyadmin|wp-admin|wp-login\.php|xmlrpc\.php|vendor/|composer\.(json|lock)|info\.php|test\.php|_profiler|setup\.php|install\.php|\.git|\.hg|\.svn) {
    return 444;
}

# Optional: drop very “botty” user agents (broad, but cheap)
# If this feels too aggressive, comment out lines below.
if ($http_user_agent ~* (curl|python|httpx|wget|nikto|sqlmap|masscan|zgrab|scrapy|libwww-perl|go-http-client)) {
    return 444;
}
