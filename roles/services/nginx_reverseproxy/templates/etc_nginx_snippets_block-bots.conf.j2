# Generated by Ansible — lightweight bot/scanner mitigations.
# Include this inside each server {}, above app locations.

# Allow ACME challenges unconditionally (don’t break certbot HTTP-01)
location ^~ /.well-known/acme-challenge/ {
    default_type "text/plain";
    try_files $uri =404;
}

# One-shot 444 for bad UA / URI
if ($is_bad_ua)  { return 444; }
if ($is_bad_uri) { return 444; }

# Optional: only allow common methods
if ($request_method !~ ^(GET|HEAD|POST|OPTIONS|PROPFIND|REPORT|MKCOL|PUT|DELETE|MOVE|COPY|PROPPATCH|LOCK|UNLOCK|PATCH)$ ) {
     return 405; 
}

# Extra hard 444s by extension (cheap)
location ~* \.(bak|old|save|swp|swo|orig|tmp|zip|tar|tgz|gz|7z)$ { return 444; }

# Legacy scanners you don’t run
location ~* /(phpmyadmin|wp-admin|wp-login\.php|xmlrpc\.php|vendor/|composer\.(json|lock)|info\.php|test\.php|_profiler|setup\.php|install\.php|\.git|\.hg|\.svn) { return 444; }
