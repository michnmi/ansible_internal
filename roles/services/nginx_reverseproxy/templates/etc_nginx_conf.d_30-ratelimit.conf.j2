# Generated by Ansible â€” basic per-IP request rate limit zones.

# Decide what key to use for rate limiting, based on client IP.
# Router IP (hairpin NAT) -> empty key => not limited
# Everyone else -> $binary_remote_addr => limited
geo $remote_addr $limit_key {
    default        $binary_remote_addr;
    192.168.1.254  "";
}


# General per-IP limit: 5 req/sec with ~10 MB state (plenty for my home scale)
limit_req_zone $limit_key zone=req_per_ip:10m rate=5r/s;

# If I ever want a stricter zone (e.g. for login endpoints), I should define it here:
# limit_req_zone $binary_remote_addr zone=req_per_ip_strict:10m rate=1r/s;
